<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Product Research Results</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;background:#f3f4f6;color:#111827;line-height:1.6;-webkit-font-smoothing:antialiased}
a{color:#2563eb;text-decoration:none}
a:hover{text-decoration:underline}

/* Header */
.header{background:#fff;border-bottom:1px solid #e5e7eb;padding:2rem 1.5rem}
.header-inner{max-width:960px;margin:0 auto}
.header h1{font-size:1.75rem;font-weight:700;color:#111827;margin-bottom:.5rem}
.header-meta{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:1rem;font-size:.875rem;color:#6b7280}
.header-meta span{display:inline-flex;align-items:center;gap:.25rem}
.tags{display:flex;flex-wrap:wrap;gap:.375rem}
.tag{background:#eff6ff;color:#1d4ed8;padding:.25rem .625rem;border-radius:9999px;font-size:.75rem;font-weight:500}

/* Recommendation */
.recommendation{max-width:960px;margin:1.5rem auto;padding:1.25rem 1.5rem;background:linear-gradient(135deg,#eff6ff,#f0fdf4);border:1px solid #bfdbfe;border-radius:.75rem;font-size:.95rem;color:#1e3a5f;line-height:1.7}
.recommendation::before{content:"\1F4A1";margin-right:.5rem}

/* Product List */
.products{max-width:960px;margin:0 auto;padding:0 1rem 3rem}
.product-card{background:#fff;border-radius:.75rem;box-shadow:0 1px 3px rgba(0,0,0,.06),0 1px 2px rgba(0,0,0,.04);margin-bottom:1.25rem;overflow:hidden;border:1px solid #e5e7eb;transition:box-shadow .2s}
.product-card:hover{box-shadow:0 4px 12px rgba(0,0,0,.08)}

/* Card Header */
.card-header{display:flex;align-items:center;gap:.75rem;padding:1rem 1.5rem;border-bottom:1px solid #f3f4f6;background:#fafbfc}
.rank{display:inline-flex;align-items:center;justify-content:center;width:2rem;height:2rem;border-radius:.5rem;font-weight:700;font-size:.875rem;color:#fff;background:linear-gradient(135deg,#2563eb,#7c3aed);flex-shrink:0}
.rank.silver{background:linear-gradient(135deg,#64748b,#475569)}
.rank.bronze{background:linear-gradient(135deg,#b45309,#92400e)}
.card-header h2{font-size:1.125rem;font-weight:600;flex:1}
.price-tag{font-size:1.125rem;font-weight:700;color:#059669}

/* Card Body */
.card-body{padding:1.5rem;display:grid;grid-template-columns:160px 1fr;gap:1.5rem}
@media(max-width:640px){.card-body{grid-template-columns:1fr;gap:1rem}}

.product-image{width:160px;height:160px;border-radius:.5rem;object-fit:contain;background:#f9fafb;border:1px solid #f3f4f6;align-self:start}
.product-image.placeholder{display:flex;align-items:center;justify-content:center;font-size:2.5rem;color:#d1d5db}
@media(max-width:640px){.product-image{width:100%;height:200px}}

.product-details{min-width:0}
.rating{display:flex;align-items:center;gap:.375rem;margin-bottom:.5rem;font-size:.875rem}
.stars{color:#f59e0b;letter-spacing:1px}
.rating-text{color:#6b7280}
.price-range{font-size:.85rem;color:#6b7280;margin-bottom:.75rem}
.best-for{display:inline-block;background:#f0fdf4;color:#065f46;padding:.25rem .75rem;border-radius:.375rem;font-size:.8rem;font-weight:500;margin-bottom:.75rem}
.highlights{font-size:.9rem;color:#374151;margin-bottom:1rem;line-height:1.6}

/* Pros/Cons */
.pros-cons{display:grid;grid-template-columns:1fr 1fr;gap:1rem;padding:0 1.5rem 1.25rem}
@media(max-width:640px){.pros-cons{grid-template-columns:1fr}}
.pros h4,.cons h4{font-size:.8rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;margin-bottom:.5rem}
.pros h4{color:#059669}
.cons h4{color:#dc2626}
.pros ul,.cons ul{list-style:none;font-size:.875rem}
.pros li,.cons li{padding:.25rem 0;padding-left:1.25rem;position:relative}
.pros li::before{content:"\2713";position:absolute;left:0;color:#059669;font-weight:700;font-size:.75rem}
.cons li::before{content:"\2717";position:absolute;left:0;color:#dc2626;font-weight:700;font-size:.75rem}

/* Buy Links */
.buy-section{padding:1rem 1.5rem;border-top:1px solid #f3f4f6;background:#fafbfc}
.buy-section h4{font-size:.8rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;color:#6b7280;margin-bottom:.625rem}
.buy-links{display:flex;flex-wrap:wrap;gap:.5rem}
.buy-link{display:inline-flex;align-items:center;gap:.375rem;padding:.5rem 1rem;background:#2563eb;color:#fff;border-radius:.5rem;font-size:.85rem;font-weight:500;text-decoration:none;transition:background .15s}
.buy-link:hover{background:#1d4ed8;text-decoration:none}
.buy-link .store-price{opacity:.85;font-weight:400}

/* Footer */
.footer{max-width:960px;margin:0 auto;padding:1rem 1.5rem 3rem;text-align:center;font-size:.8rem;color:#9ca3af}

/* Empty State */
.empty{max-width:960px;margin:4rem auto;text-align:center;color:#9ca3af}
.empty h2{font-size:1.5rem;margin-bottom:.5rem;color:#6b7280}

/* Source badges */
.source-badge{display:inline-block;background:#f3f4f6;color:#6b7280;padding:.125rem .5rem;border-radius:.25rem;font-size:.7rem;margin-left:.25rem;font-weight:400}
</style>
</head>
<body>

<div id="app"></div>

<script>
const DATA = __PRODUCT_DATA__;

function renderStars(rating) {
  const full = Math.floor(rating);
  const half = rating - full >= 0.5 ? 1 : 0;
  const empty = 5 - full - half;
  return '\u2605'.repeat(full) + (half ? '\u00BD' : '') + '\u2606'.repeat(empty);
}

function escapeHtml(str) {
  if (!str) return '';
  const d = document.createElement('div');
  d.textContent = str;
  return d.innerHTML;
}

function rankClass(i) {
  if (i === 0) return 'rank';
  if (i === 1) return 'rank silver';
  if (i === 2) return 'rank bronze';
  return 'rank silver';
}

function renderBuyLinks(links) {
  if (!links || !links.length) return '';
  const btns = links.map(l => {
    const price = l.price ? ` <span class="store-price">${escapeHtml(String(l.price))}</span>` : '';
    return `<a href="${escapeHtml(l.url)}" class="buy-link" target="_blank" rel="noopener">${escapeHtml(l.store)}${price}</a>`;
  }).join('');
  return `<div class="buy-section"><h4>Where to Buy</h4><div class="buy-links">${btns}</div></div>`;
}

function renderProduct(p, i) {
  const imgHtml = p.image
    ? `<img src="${escapeHtml(p.image)}" alt="${escapeHtml(p.name)}" class="product-image" loading="lazy" onerror="this.outerHTML='<div class=\\'product-image placeholder\\'>üì¶</div>'">`
    : `<div class="product-image placeholder">üì¶</div>`;

  const ratingHtml = p.rating
    ? `<div class="rating"><span class="stars">${renderStars(p.rating)}</span> <strong>${p.rating}</strong>${p.ratingSource ? ` <span class="rating-text">¬∑ ${escapeHtml(p.ratingSource)}</span>` : ''}</div>`
    : '';

  const priceRange = p.priceRange ? `<div class="price-range">${escapeHtml(p.priceRange)}</div>` : '';
  const bestFor = p.bestFor ? `<div class="best-for">${escapeHtml(p.bestFor)}</div>` : '';
  const highlights = p.highlights ? `<div class="highlights">${escapeHtml(p.highlights)}</div>` : '';

  const prosHtml = p.pros && p.pros.length
    ? `<div class="pros"><h4>Pros</h4><ul>${p.pros.map(x => `<li>${escapeHtml(x)}</li>`).join('')}</ul></div>` : '';
  const consHtml = p.cons && p.cons.length
    ? `<div class="cons"><h4>Cons</h4><ul>${p.cons.map(x => `<li>${escapeHtml(x)}</li>`).join('')}</ul></div>` : '';

  const priceTag = p.price ? `<span class="price-tag">${escapeHtml(String(p.price))}</span>` : '';

  return `
    <div class="product-card">
      <div class="card-header">
        <span class="${rankClass(i)}">${p.rank || i + 1}</span>
        <h2>${escapeHtml(p.name)}</h2>
        ${priceTag}
      </div>
      <div class="card-body">
        ${imgHtml}
        <div class="product-details">
          ${ratingHtml}
          ${priceRange}
          ${bestFor}
          ${highlights}
        </div>
      </div>
      ${prosHtml || consHtml ? `<div class="pros-cons">${prosHtml}${consHtml}</div>` : ''}
      ${renderBuyLinks(p.buyLinks)}
    </div>`;
}

function render() {
  if (!DATA || !DATA.products || !DATA.products.length) {
    document.getElementById('app').innerHTML = '<div class="empty"><h2>No products found</h2><p>Research data is missing or empty.</p></div>';
    return;
  }

  const m = DATA.metadata || {};
  const tags = (m.priorities || []).map(t => `<span class="tag">${escapeHtml(t)}</span>`).join('');

  const metaParts = [];
  if (m.date) metaParts.push(`<span>üìÖ ${escapeHtml(m.date)}</span>`);
  if (m.location) metaParts.push(`<span>üìç ${escapeHtml(m.location)}</span>`);
  if (m.budget) metaParts.push(`<span>üí∞ ${escapeHtml(m.budget)}</span>`);

  const recHtml = DATA.recommendation
    ? `<div class="recommendation">${escapeHtml(DATA.recommendation)}</div>` : '';

  const productsHtml = DATA.products.map((p, i) => renderProduct(p, i)).join('');

  document.getElementById('app').innerHTML = `
    <div class="header">
      <div class="header-inner">
        <h1>${escapeHtml(m.query || 'Product Research Results')}</h1>
        ${metaParts.length ? `<div class="header-meta">${metaParts.join('')}</div>` : ''}
        ${tags ? `<div class="tags">${tags}</div>` : ''}
      </div>
    </div>
    ${recHtml}
    <div class="products">${productsHtml}</div>
    <div class="footer">Research compiled by AI Product Researcher. Prices and availability may vary. Always verify before purchasing.</div>
  `;

  document.title = m.query ? `${m.query} ‚Äî Product Research` : 'Product Research Results';
}

render();
</script>
</body>
</html>
